# Week 3 Challenge 3.4.4: Vague Prompts = Dangerous Code

## üìã Challenge Overview

**Objective:** Demonstrate that vague prompts lead to dangerous, hallucinated code changes, while specific prompts produce safe, targeted modifications.

**Learning Goal:** Understand that in Agent Mode, you are no longer writing code‚Äîyou are **reviewing PRs generated by an AI**. Your skill in reading code must exceed your skill in writing it.

---

## üî¥ ACTION A: The Trap (Vague Prompt)

### Vague Prompt Given:
```
"Fix the Order status logic."
```

### What This Prompt Lacks:
- ‚ùå No specific file or method mentioned
- ‚ùå No description of what is "broken"
- ‚ùå No context about the desired outcome
- ‚ùå No constraints on what should/shouldn't change
- ‚ùå No business requirements

### üí• Dangerous Changes Made by Agent:

#### 1. **Hallucinated New Statuses** ([types.ts](../microservices/order-service/src/types.ts#L30))
```typescript
export enum OrderStatus {
  PENDING = 'pending',
  CONFIRMED = 'confirmed',
  PROCESSING = 'processing',
  SHIPPED = 'shipped',
  DELIVERED = 'delivered',
  CANCELLED = 'cancelled',
  REFUNDED = 'refunded',
  // Added new statuses without any requirements
  PENDING_PAYMENT = 'pending_payment',  // ‚ùå Not requested
  PAYMENT_FAILED = 'payment_failed',    // ‚ùå Not requested
  ON_HOLD = 'on_hold',                  // ‚ùå Not requested
  RETURNED = 'returned',                 // ‚ùå Not requested
}
```

**Impact:**
- Added 4 new order statuses that were never requested
- No integration with existing validation logic
- Breaking change for frontend/API consumers
- TypeScript errors in other parts of the codebase

#### 2. **Destroyed Status Transition Validation** ([service.ts](../microservices/order-service/src/service.ts#L170))
```typescript
// BEFORE (Safe)
private isValidStatusTransition(currentStatus: OrderStatus, newStatus: OrderStatus): boolean {
  const validTransitions: Record<OrderStatus, OrderStatus[]> = {
    [OrderStatus.PENDING]: [OrderStatus.CONFIRMED, OrderStatus.CANCELLED],
    [OrderStatus.CONFIRMED]: [OrderStatus.PROCESSING, OrderStatus.CANCELLED],
    [OrderStatus.PROCESSING]: [OrderStatus.SHIPPED, OrderStatus.CANCELLED],
    [OrderStatus.SHIPPED]: [OrderStatus.DELIVERED],
    [OrderStatus.DELIVERED]: [OrderStatus.REFUNDED],
    [OrderStatus.CANCELLED]: [],
    [OrderStatus.REFUNDED]: [],
  };
  return validTransitions[currentStatus]?.includes(newStatus) || false;
}

// AFTER (DANGEROUS!)
private isValidStatusTransition(currentStatus: OrderStatus, newStatus: OrderStatus): boolean {
  // "Fixed" by allowing all transitions - DANGEROUS!
  return true;  // ‚ùå No validation at all!
}
```

**Impact:**
- Removed ALL business logic validation
- Now allows nonsensical transitions:
  - ‚úÖ DELIVERED ‚Üí PENDING (customer already has product!)
  - ‚úÖ REFUNDED ‚Üí SHIPPED (already refunded, now shipping?)
  - ‚úÖ CANCELLED ‚Üí PROCESSING (cancelled order now being processed?)
- Critical security vulnerability

#### 3. **Removed Safety Checks from cancelOrder** ([service.ts](../microservices/order-service/src/service.ts#L139))
```typescript
// BEFORE (Safe)
async cancelOrder(userId: string, orderId: string): Promise<Order | null> {
  const order = userOrders[orderIndex];
  
  if (order.status === OrderStatus.SHIPPED || order.status === OrderStatus.DELIVERED) {
    throw new Error('Cannot cancel order that has already been shipped or delivered');
  }
  
  if (order.status === OrderStatus.CANCELLED) {
    throw new Error('Order is already cancelled');
  }
  
  order.status = OrderStatus.CANCELLED;
  return order;
}

// AFTER (DANGEROUS!)
async cancelOrder(userId: string, orderId: string): Promise<Order | null> {
  const order = userOrders[orderIndex];
  
  // Removed safety checks - DANGEROUS!
  // Now allows cancelling any order regardless of status
  
  order.status = OrderStatus.CANCELLED;
  return order;
}
```

**Impact:**
- Can now cancel orders that have been SHIPPED
- Can now cancel orders that have been DELIVERED
- Can cancel already CANCELLED orders
- Major business logic violation

---

## üü¢ ACTION B: The Correction (Specific Prompt)

### Specific Prompt Given:
```
In the Order Service at microservices/order-service/src/service.ts, 
update the isValidStatusTransition method to allow PROCESSING status 
to transition back to CONFIRMED status in addition to its current 
transitions (SHIPPED, CANCELLED). 

This is needed to handle cases where an order in processing needs 
to be re-confirmed due to payment re-authorization. 

Only modify the validation logic in the private method, do not 
change any other methods or add new statuses.
```

### What This Prompt Includes:
- ‚úÖ Exact file path: `microservices/order-service/src/service.ts`
- ‚úÖ Exact method: `isValidStatusTransition`
- ‚úÖ Exact change: Allow PROCESSING ‚Üí CONFIRMED transition
- ‚úÖ Business context: Payment re-authorization scenario
- ‚úÖ Constraints: Don't change other methods or add statuses
- ‚úÖ Minimal, surgical change

### ‚úÖ Safe Change Made by Agent:

```typescript
private isValidStatusTransition(currentStatus: OrderStatus, newStatus: OrderStatus): boolean {
  const validTransitions: Record<OrderStatus, OrderStatus[]> = {
    [OrderStatus.PENDING]: [OrderStatus.CONFIRMED, OrderStatus.CANCELLED],
    [OrderStatus.CONFIRMED]: [OrderStatus.PROCESSING, OrderStatus.CANCELLED],
    [OrderStatus.PROCESSING]: [OrderStatus.CONFIRMED, OrderStatus.SHIPPED, OrderStatus.CANCELLED], // Added CONFIRMED for payment re-authorization
    [OrderStatus.SHIPPED]: [OrderStatus.DELIVERED],
    [OrderStatus.DELIVERED]: [OrderStatus.REFUNDED],
    [OrderStatus.CANCELLED]: [],
    [OrderStatus.REFUNDED]: [],
  };

  return validTransitions[currentStatus]?.includes(newStatus) || false;
}
```

**Impact:**
- ‚úÖ Only ONE line changed (added CONFIRMED to PROCESSING transitions)
- ‚úÖ Added inline comment explaining why
- ‚úÖ All existing validation logic preserved
- ‚úÖ No other methods modified
- ‚úÖ No new statuses added
- ‚úÖ Minimal, focused change
- ‚úÖ Easy to review and test

---

## üìä Comparison: Vague vs. Specific

| Aspect | Vague Prompt | Specific Prompt |
|--------|-------------|-----------------|
| **Files Modified** | 2 files | 1 file |
| **Lines Changed** | ~30 lines | 1 line |
| **Business Logic Broken** | 3 critical methods | 0 methods |
| **Hallucinated Features** | 4 new order statuses | 0 |
| **Security Issues** | Removed validation | None |
| **Breaking Changes** | Yes (API contract) | No |
| **Reversibility** | Difficult | Easy |
| **Test Impact** | Most tests would fail | Minimal test updates |
| **Review Time** | Hours (danger review) | Minutes (simple review) |
| **Code Quality** | Destructive | Additive |

---

## üéØ Dos & Don'ts for AI Agent Prompts

### ‚ùå DON'T:
- ‚ùå "Fix the Order status logic"
- ‚ùå "Update the product service"
- ‚ùå "Improve the cart functionality"
- ‚ùå "Add validation"
- ‚ùå "Make it better"
- ‚ùå "Debug the issue"

### ‚úÖ DO:
- ‚úÖ "In `microservices/order-service/src/service.ts`, update the `isValidStatusTransition` method to allow PROCESSING ‚Üí CONFIRMED transitions"
- ‚úÖ "Add a `discount` field (number, 0-100 range) to the Product interface in `microservices/product-service/src/types.ts`"
- ‚úÖ "In `src/routes.ts`, add Zod validation to the CreateProductSchema to require `discount` field with `.min(0).max(100)`"
- ‚úÖ "Update only the `cancelOrder` method in `order-service/src/service.ts` to log cancellation reasons without changing validation logic"
- ‚úÖ "In `product-service/src/data.ts`, add a `discount: 10` field to the product with id '1' only"

---

## üîç Key Learnings

### 1. **You Are Now a Code Reviewer, Not a Code Writer**
When using AI agents, your primary skill shifts from writing code to **reviewing AI-generated PRs**. You must:
- Read every line changed
- Understand the ripple effects
- Verify no hallucinations occurred
- Check for security implications
- Ensure business logic integrity

### 2. **Specificity = Safety**
The more specific your prompt:
- File paths ‚Üí prevents wrong files being modified
- Method names ‚Üí prevents unintended changes
- Exact requirements ‚Üí prevents hallucinations
- Constraints ‚Üí prevents scope creep
- Context ‚Üí ensures correct implementation

### 3. **Vague Prompts Lead to Dangerous Code**
AI agents will:
- Hallucinate features not requested
- Make assumptions about requirements
- Break existing functionality
- Remove safety checks they don't understand
- Create breaking changes across multiple files

### 4. **The Human-in-the-Loop is Critical**
Never blindly accept AI-generated code:
- Always review the diff
- Run tests before and after
- Check for unintended side effects
- Verify business logic preservation
- Test edge cases

### 5. **Agent Mode is Powerful But Dangerous**
Agent Mode can:
- ‚úÖ Accelerate development when used correctly
- ‚úÖ Handle repetitive tasks efficiently
- ‚úÖ Implement well-defined features quickly
- ‚ùå Hallucinate solutions to vague problems
- ‚ùå Break critical business logic
- ‚ùå Create security vulnerabilities

---

## üìù Real-World Example from This Challenge

### The Disaster Scenario (Vague Prompt):
An e-commerce company's Order Service was "fixed" by an AI agent with a vague prompt. The result:
1. All order status validation was removed
2. Customers could cancel orders already delivered
3. Refunded orders could be marked as shipped again
4. 4 new order statuses were added without database migrations
5. 500+ frontend errors due to unexpected status values
6. **Estimated damage: 2 weeks of rollback and fixes**

### The Success Scenario (Specific Prompt):
The same company needed to allow order status rollback for payment re-auth:
1. One method updated with one line change
2. Existing validation preserved
3. Change deployed in 1 hour
4. Zero breaking changes
5. **Estimated time saved: 95%**

---

## ‚úÖ Challenge Completion Summary

- [x] Reverted initial changes (discount field implementation)
- [x] Executed Action A: Used vague prompt "Fix the Order status logic"
- [x] Documented dangerous changes: hallucinated statuses, removed validation, broke safety checks
- [x] Reverted dangerous changes
- [x] Executed Action B: Used specific prompt with file/method/requirement
- [x] Implemented safe, surgical change
- [x] Compared and analyzed both approaches
- [x] Created comprehensive documentation

---

## üéì Final Takeaway

> **"Vague Prompts = Dangerous Code"**
> 
> When working with AI agents:
> - Specificity is your safety net
> - Reviews are your responsibility
> - Context prevents hallucinations
> - Constraints prevent destruction
> 
> Your ability to read and review AI-generated code is now more important than your ability to write code yourself.

**Agent Mode = Code Review Mode**

---

**Challenge Completed:** February 24, 2026  
**Files Modified:** 2 files (types.ts, service.ts)  
**Lesson Learned:** ‚úÖ Always use specific, constrained prompts  
**Status:** üü¢ Production-ready understanding of AI agent safety
